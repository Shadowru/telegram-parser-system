# docker-compose.worker.yml
version: '3.8'

services:
  worker:
    build:
      context: ./worker
      dockerfile: Dockerfile
    environment:
      # Collector API
      COLLECTOR_API_URL: ${COLLECTOR_API_URL}  # http://main-server:8000
      WORKER_AUTH_TOKEN: ${WORKER_AUTH_TOKEN}
      
      # Telegram API
      TELEGRAM_API_ID: ${TELEGRAM_API_ID}
      TELEGRAM_API_HASH: ${TELEGRAM_API_HASH}
      TELEGRAM_PHONE: ${TELEGRAM_PHONE}
      
      # Worker settings
      WORKER_ID: ${WORKER_ID:-worker-1}
      WORKER_NAME: ${WORKER_NAME:-Worker 1}
      WORKER_LOCATION: ${WORKER_LOCATION:-Server A}
      
      # Performance
      MAX_CONCURRENT_CHANNELS: ${MAX_CONCURRENT_CHANNELS:-5}
      MESSAGE_BATCH_SIZE: ${MESSAGE_BATCH_SIZE:-50}
      HEARTBEAT_INTERVAL: ${HEARTBEAT_INTERVAL:-30}
      
      # Logging
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      
    volumes:
      - worker_sessions:/app/sessions
      - worker_logs:/app/logs
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  worker_sessions:
  worker_logs: